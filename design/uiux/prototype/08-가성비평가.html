<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ì„±ë¹„ í‰ê°€ - í‘¸ë””ìŠ¤íŒŸ</title>
    <link rel="stylesheet" href="common.css">
    <style>
        /* ê°€ì„±ë¹„í‰ê°€ ì „ìš© ìŠ¤íƒ€ì¼ */
        .evaluation-container {
            padding: 20px 0;
        }

        .progress-header {
            position: sticky;
            top: 60px;
            background: #FFFFFF;
            z-index: 10;
            padding: 16px 0;
            border-bottom: 1px solid #E5E7EB;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #E5E7EB;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563EB 0%, #3B82F6 100%);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 14px;
        }

        .progress-step {
            color: #2563EB;
            font-weight: 600;
        }

        .progress-title {
            color: #6B7280;
        }

        .evaluation-step {
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .evaluation-step.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .step-header {
            text-align: center;
            margin: 32px 0;
        }

        .step-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin-bottom: 16px;
        }

        .step-icon.price {
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
        }

        .step-icon.portion {
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
        }

        .step-icon.taste {
            background: linear-gradient(135deg, #FED7AA 0%, #FDBA74 100%);
        }

        .step-icon.service {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
        }

        .step-title {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }

        .step-description {
            font-size: 16px;
            color: #6B7280;
        }

        .rating-interface {
            margin: 32px 0;
        }

        .score-buttons {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin: 24px 0;
        }

        .score-button {
            flex: 1;
            padding: 16px 8px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            background: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .score-button:hover {
            border-color: #2563EB;
            transform: translateY(-2px);
        }

        .score-button.selected {
            border-color: #2563EB;
            background: #EEF2FF;
        }

        .score-number {
            font-size: 24px;
            font-weight: 700;
            color: #2563EB;
            margin-bottom: 4px;
        }

        .score-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 500;
        }

        .score-button.selected .score-label {
            color: #2563EB;
        }

        .score-descriptions {
            display: flex;
            justify-content: space-between;
            margin: 16px 0;
            font-size: 12px;
            color: #9CA3AF;
        }

        .expectation-compare {
            margin: 24px 0;
            padding: 20px;
            background: #F9FAFB;
            border-radius: 12px;
        }

        .compare-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
            text-align: center;
        }

        .compare-options {
            display: flex;
            gap: 12px;
        }

        .compare-option {
            flex: 1;
            padding: 12px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            background: #FFFFFF;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .compare-option:hover {
            border-color: #2563EB;
        }

        .compare-option.selected {
            border-color: #2563EB;
            background: #EEF2FF;
            color: #2563EB;
        }

        .compare-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .compare-text {
            font-size: 12px;
            font-weight: 500;
        }

        .comment-section {
            margin: 24px 0;
        }

        .comment-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 12px;
        }

        .quick-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .tag-button {
            padding: 8px 16px;
            border: 1px solid #D1D5DB;
            border-radius: 20px;
            background: #FFFFFF;
            font-size: 14px;
            color: #6B7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tag-button:hover {
            border-color: #2563EB;
            color: #2563EB;
        }

        .tag-button.selected {
            border-color: #2563EB;
            background: #2563EB;
            color: #FFFFFF;
        }

        .comment-input {
            width: 100%;
            min-height: 80px;
            padding: 12px 16px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
        }

        .comment-input:focus {
            outline: none;
            border-color: #2563EB;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .step-navigation {
            display: flex;
            gap: 12px;
            margin: 32px 0;
            position: sticky;
            bottom: 80px;
            background: #FFFFFF;
            padding: 16px 0;
            border-top: 1px solid #E5E7EB;
        }

        .btn-prev {
            flex: 1;
            padding: 14px 24px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            background: #FFFFFF;
            color: #6B7280;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-prev:hover:not(:disabled) {
            border-color: #6B7280;
            color: #374151;
        }

        .btn-prev:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-next {
            flex: 2;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            background: #2563EB;
            color: #FFFFFF;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-next:hover:not(:disabled) {
            background: #1D4ED8;
        }

        .btn-next:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .completion-summary {
            text-align: center;
            margin: 32px 0;
        }

        .personal-score {
            width: 120px;
            height: 120px;
            margin: 0 auto 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scoreReveal 0.8s ease-out;
        }

        @keyframes scoreReveal {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .personal-score-number {
            font-size: 36px;
            font-weight: 700;
            color: #FFFFFF;
        }

        .score-explanation {
            font-size: 16px;
            color: #6B7280;
            margin: 16px 0;
        }

        .factor-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 24px 0;
        }

        .factor-result {
            text-align: center;
            padding: 16px;
            background: #F9FAFB;
            border-radius: 8px;
        }

        .factor-result-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .factor-result-score {
            font-size: 18px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 4px;
        }

        .factor-result-label {
            font-size: 12px;
            color: #6B7280;
        }

        .insight-message {
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 24px 0;
        }

        .insight-title {
            font-size: 16px;
            font-weight: 600;
            color: #1E40AF;
            margin-bottom: 8px;
        }

        .insight-text {
            font-size: 14px;
            color: #1E3A8A;
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <button class="btn-ghost back-button" aria-label="ë’¤ë¡œê°€ê¸°">
                    <span style="font-size: 18px;">â†</span>
                </button>
                <h1 class="navbar-title">ê°€ì„±ë¹„ í‰ê°€</h1>
                <div style="width: 44px;"></div>
            </div>
        </div>
    </nav>

    <!-- ì§„í–‰ ìƒí™© -->
    <div class="progress-header">
        <div class="container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span class="progress-step" id="progressStep">1/4ë‹¨ê³„</span>
                <span class="progress-title" id="progressTitle">ê°€ê²© í‰ê°€</span>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="container evaluation-container">
        <!-- 1ë‹¨ê³„: ê°€ê²© í‰ê°€ -->
        <div class="evaluation-step active" id="step1">
            <div class="step-header">
                <div class="step-icon price">ğŸ’°</div>
                <h2 class="step-title">ê°€ê²©ì€ ì–´ë– ì…¨ë‚˜ìš”?</h2>
                <p class="step-description">ì§€ë¶ˆí•œ ê¸ˆì•¡ ëŒ€ë¹„ ë§Œì¡±ë„ë¥¼ í‰ê°€í•´ì£¼ì„¸ìš”</p>
            </div>

            <div class="rating-interface">
                <div class="score-buttons" id="priceScore">
                    <button class="score-button" data-score="1">
                        <div class="score-number">1</div>
                        <div class="score-label">ë¹„ìŒˆ</div>
                    </button>
                    <button class="score-button" data-score="2">
                        <div class="score-number">2</div>
                        <div class="score-label">ì•½ê°„ ë¹„ìŒŒ</div>
                    </button>
                    <button class="score-button" data-score="3">
                        <div class="score-number">3</div>
                        <div class="score-label">ì ë‹¹</div>
                    </button>
                    <button class="score-button" data-score="4">
                        <div class="score-number">4</div>
                        <div class="score-label">ì €ë ´</div>
                    </button>
                    <button class="score-button" data-score="5">
                        <div class="score-number">5</div>
                        <div class="score-label">ë§¤ìš° ì €ë ´</div>
                    </button>
                </div>

                <div class="expectation-compare">
                    <h3 class="compare-title">ì˜ˆìƒí–ˆë˜ ê°€ê²©ê³¼ ë¹„êµí•˜ë©´?</h3>
                    <div class="compare-options" id="priceExpectation">
                        <button class="compare-option" data-compare="higher">
                            <div class="compare-icon">ğŸ“ˆ</div>
                            <div class="compare-text">ì˜ˆìƒë³´ë‹¤ ë¹„ìŒŒ</div>
                        </button>
                        <button class="compare-option" data-compare="same">
                            <div class="compare-icon">ğŸ‘</div>
                            <div class="compare-text">ì˜ˆìƒê³¼ ê°™ìŒ</div>
                        </button>
                        <button class="compare-option" data-compare="lower">
                            <div class="compare-icon">ğŸ“‰</div>
                            <div class="compare-text">ì˜ˆìƒë³´ë‹¤ ì €ë ´</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2ë‹¨ê³„: ì–‘ í‰ê°€ -->
        <div class="evaluation-step" id="step2">
            <div class="step-header">
                <div class="step-icon portion">ğŸ½ï¸</div>
                <h2 class="step-title">ì–‘ì€ ì¶©ë¶„í–ˆë‚˜ìš”?</h2>
                <p class="step-description">ìŒì‹ì˜ ì–‘ê³¼ í¬ë§Œê°ì„ í‰ê°€í•´ì£¼ì„¸ìš”</p>
            </div>

            <div class="rating-interface">
                <div class="score-buttons" id="portionScore">
                    <button class="score-button" data-score="1">
                        <div class="score-number">1</div>
                        <div class="score-label">ë„ˆë¬´ ì ìŒ</div>
                    </button>
                    <button class="score-button" data-score="2">
                        <div class="score-number">2</div>
                        <div class="score-label">ì ìŒ</div>
                    </button>
                    <button class="score-button" data-score="3">
                        <div class="score-number">3</div>
                        <div class="score-label">ì ë‹¹</div>
                    </button>
                    <button class="score-button" data-score="4">
                        <div class="score-number">4</div>
                        <div class="score-label">ë„‰ë„‰</div>
                    </button>
                    <button class="score-button" data-score="5">
                        <div class="score-number">5</div>
                        <div class="score-label">ë§¤ìš° ë„‰ë„‰</div>
                    </button>
                </div>

                <div class="expectation-compare">
                    <h3 class="compare-title">ì˜ˆìƒí–ˆë˜ ì–‘ê³¼ ë¹„êµí•˜ë©´?</h3>
                    <div class="compare-options" id="portionExpectation">
                        <button class="compare-option" data-compare="less">
                            <div class="compare-icon">ğŸ“‰</div>
                            <div class="compare-text">ì˜ˆìƒë³´ë‹¤ ì ìŒ</div>
                        </button>
                        <button class="compare-option" data-compare="same">
                            <div class="compare-icon">ğŸ‘</div>
                            <div class="compare-text">ì˜ˆìƒê³¼ ê°™ìŒ</div>
                        </button>
                        <button class="compare-option" data-compare="more">
                            <div class="compare-icon">ğŸ“ˆ</div>
                            <div class="compare-text">ì˜ˆìƒë³´ë‹¤ ë§ìŒ</div>
                        </button>
                    </div>
                </div>

                <div class="comment-section">
                    <h3 class="comment-title">ì–´ë–¤ ì ì´ ì¸ìƒì ì´ì—ˆë‚˜ìš”? (ì„ íƒ)</h3>
                    <div class="quick-tags" id="portionTags">
                        <button class="tag-button" data-tag="generous">í‘¸ì§í•œ ì–‘</button>
                        <button class="tag-button" data-tag="perfect">ë”± ì ë‹¹</button>
                        <button class="tag-button" data-tag="small">ì•„ì‰¬ìš´ ì–‘</button>
                        <button class="tag-button" data-tag="variety">ë‹¤ì–‘í•œ êµ¬ì„±</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3ë‹¨ê³„: ë§› í‰ê°€ -->
        <div class="evaluation-step" id="step3">
            <div class="step-header">
                <div class="step-icon taste">ğŸ˜‹</div>
                <h2 class="step-title">ë§›ì€ ì–´ë– ì…¨ë‚˜ìš”?</h2>
                <p class="step-description">ìŒì‹ì˜ ë§›ê³¼ í’ˆì§ˆì„ í‰ê°€í•´ì£¼ì„¸ìš”</p>
            </div>

            <div class="rating-interface">
                <div class="score-buttons" id="tasteScore">
                    <button class="score-button" data-score="1">
                        <div class="score-number">1</div>
                        <div class="score-label">ë³„ë¡œ</div>
                    </button>
                    <button class="score-button" data-score="2">
                        <div class="score-number">2</div>
                        <div class="score-label">ì•„ì‰¬ì›€</div>
                    </button>
                    <button class="score-button" data-score="3">
                        <div class="score-number">3</div>
                        <div class="score-label">ê´œì°®ìŒ</div>
                    </button>
                    <button class="score-button" data-score="4">
                        <div class="score-number">4</div>
                        <div class="score-label">ë§›ìˆìŒ</div>
                    </button>
                    <button class="score-button" data-score="5">
                        <div class="score-number">5</div>
                        <div class="score-label">ìµœê³ !</div>
                    </button>
                </div>

                <div class="comment-section">
                    <h3 class="comment-title">ë§›ì˜ íŠ¹ì§•ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                    <div class="quick-tags" id="tasteTags">
                        <button class="tag-button" data-tag="fresh">ì‹ ì„ í•¨</button>
                        <button class="tag-button" data-tag="spicy">ì ë‹¹í•œ ë§¤ìš´ë§›</button>
                        <button class="tag-button" data-tag="mild">ë‹´ë°±í•¨</button>
                        <button class="tag-button" data-tag="rich">ì§„í•œ ë§›</button>
                        <button class="tag-button" data-tag="balanced">ê· í˜•ì¡íŒ ë§›</button>
                        <button class="tag-button" data-tag="unique">íŠ¹ë³„í•œ ë§›</button>
                    </div>

                    <textarea class="comment-input" id="tasteComment" placeholder="ë§›ì— ëŒ€í•œ ìì„¸í•œ ì½”ë©˜íŠ¸ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš” (ì„ íƒ)"></textarea>
                </div>
            </div>
        </div>

        <!-- 4ë‹¨ê³„: ì„œë¹„ìŠ¤ í‰ê°€ -->
        <div class="evaluation-step" id="step4">
            <div class="step-header">
                <div class="step-icon service">ğŸ¤</div>
                <h2 class="step-title">ì„œë¹„ìŠ¤ëŠ” ì–´ë– ì…¨ë‚˜ìš”?</h2>
                <p class="step-description">ì§ì›ì˜ ì¹œì ˆë„ì™€ ì„œë¹„ìŠ¤ë¥¼ í‰ê°€í•´ì£¼ì„¸ìš”</p>
            </div>

            <div class="rating-interface">
                <div class="score-buttons" id="serviceScore">
                    <button class="score-button" data-score="1">
                        <div class="score-number">1</div>
                        <div class="score-label">ë¶ˆì¹œì ˆ</div>
                    </button>
                    <button class="score-button" data-score="2">
                        <div class="score-number">2</div>
                        <div class="score-label">ì•„ì‰¬ì›€</div>
                    </button>
                    <button class="score-button" data-score="3">
                        <div class="score-number">3</div>
                        <div class="score-label">ë³´í†µ</div>
                    </button>
                    <button class="score-button" data-score="4">
                        <div class="score-number">4</div>
                        <div class="score-label">ì¹œì ˆ</div>
                    </button>
                    <button class="score-button" data-score="5">
                        <div class="score-number">5</div>
                        <div class="score-label">ë§¤ìš° ì¹œì ˆ</div>
                    </button>
                </div>

                <div class="comment-section">
                    <h3 class="comment-title">ì„œë¹„ìŠ¤ì˜ íŠ¹ì§•ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                    <div class="quick-tags" id="serviceTags">
                        <button class="tag-button" data-tag="kind">ì¹œì ˆí•¨</button>
                        <button class="tag-button" data-tag="fast">ë¹ ë¥¸ ì„œë¹™</button>
                        <button class="tag-button" data-tag="clean">ê¹”ë”í•œ ì •ë¦¬</button>
                        <button class="tag-button" data-tag="professional">ì „ë¬¸ì </button>
                        <button class="tag-button" data-tag="attentive">ì„¸ì‹¬í•¨</button>
                        <button class="tag-button" data-tag="warm">ë”°ëœ»í•œ ì‘ëŒ€</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5ë‹¨ê³„: ì™„ë£Œ ë° ê²°ê³¼ -->
        <div class="evaluation-step" id="step5">
            <div class="completion-summary">
                <div class="personal-score">
                    <div class="personal-score-number" id="finalScore">85</div>
                </div>

                <h2 class="step-title">ê°œì¸í™” ì ìˆ˜ê°€ ê³„ì‚°ë˜ì—ˆì–´ìš”!</h2>
                <p class="score-explanation">
                    ì—¬ëŸ¬ë¶„ì˜ í‰ê°€ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬<br>
                    ë” ì •í™•í•œ ì¶”ì²œì„ ìœ„í•œ ì ìˆ˜ì˜ˆìš”
                </p>

                <div class="factor-breakdown">
                    <div class="factor-result">
                        <div class="factor-result-icon">ğŸ’°</div>
                        <div class="factor-result-score" id="priceResult">4.0</div>
                        <div class="factor-result-label">ê°€ê²©</div>
                    </div>
                    <div class="factor-result">
                        <div class="factor-result-icon">ğŸ½ï¸</div>
                        <div class="factor-result-score" id="portionResult">4.5</div>
                        <div class="factor-result-label">ì–‘</div>
                    </div>
                    <div class="factor-result">
                        <div class="factor-result-icon">ğŸ˜‹</div>
                        <div class="factor-result-score" id="tasteResult">4.0</div>
                        <div class="factor-result-label">ë§›</div>
                    </div>
                    <div class="factor-result">
                        <div class="factor-result-icon">ğŸ¤</div>
                        <div class="factor-result-score" id="serviceResult">4.2</div>
                        <div class="factor-result-label">ì„œë¹„ìŠ¤</div>
                    </div>
                </div>

                <div class="insight-message">
                    <h3 class="insight-title">ğŸ’¡ ê°œì¸í™” ì¸ì‚¬ì´íŠ¸</h3>
                    <p class="insight-text" id="personalInsight">
                        ë§›ê³¼ ê°€ê²©ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ì‹œëŠ” í¸ì´ë„¤ìš”!
                        ë¹„ìŠ·í•œ ê°€ê²©ëŒ€ì—ì„œ ë§›ìˆëŠ” ìŒì‹ì ì„ ìš°ì„  ì¶”ì²œí•´ë“œë¦´ê²Œìš”.
                    </p>
                </div>
            </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
        <div class="step-navigation">
            <button class="btn-prev" id="prevBtn" disabled>ì´ì „</button>
            <button class="btn-next" id="nextBtn" disabled>ë‹¤ìŒ</button>
        </div>
    </main>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bottom-nav">
        <a href="01-í™ˆí™”ë©´.html" class="nav-item">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-label">í™ˆ</span>
        </a>
        <a href="02-ê²€ìƒ‰ê²°ê³¼.html" class="nav-item">
            <span class="nav-icon">ğŸ”</span>
            <span class="nav-label">ê²€ìƒ‰</span>
        </a>
        <a href="06-ì£¼ë¬¸ìƒíƒœ.html" class="nav-item">
            <span class="nav-icon">ğŸ“‹</span>
            <span class="nav-label">ì£¼ë¬¸</span>
        </a>
        <a href="09-ê°œì¸ë¶„ì„.html" class="nav-item active">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-label">ë‚´ì •ë³´</span>
        </a>
    </nav>

    <script>
        // í‰ê°€ ë°ì´í„°
        const evaluationData = {
            restaurantName: 'ë§›ìˆëŠ” ê¹€ì¹˜ì°Œê°œ',
            currentStep: 1,
            totalSteps: 4,
            scores: {
                price: { score: 0, expectation: null },
                portion: { score: 0, expectation: null, tags: [] },
                taste: { score: 0, tags: [], comment: '' },
                service: { score: 0, tags: [] }
            },
            personalScore: 0,
            personalInsight: ''
        };

        // ë‹¨ê³„ë³„ ì„¤ì •
        const stepConfig = {
            1: { title: 'ê°€ê²© í‰ê°€', factor: 'price' },
            2: { title: 'ì–‘ í‰ê°€', factor: 'portion' },
            3: { title: 'ë§› í‰ê°€', factor: 'taste' },
            4: { title: 'ì„œë¹„ìŠ¤ í‰ê°€', factor: 'service' },
            5: { title: 'í‰ê°€ ì™„ë£Œ', factor: null }
        };

        // DOM ìš”ì†Œë“¤
        const elements = {
            progressFill: document.getElementById('progressFill'),
            progressStep: document.getElementById('progressStep'),
            progressTitle: document.getElementById('progressTitle'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            finalScore: document.getElementById('finalScore'),
            personalInsight: document.getElementById('personalInsight'),
            priceResult: document.getElementById('priceResult'),
            portionResult: document.getElementById('portionResult'),
            tasteResult: document.getElementById('tasteResult'),
            serviceResult: document.getElementById('serviceResult')
        };

        // ì´ˆê¸°í™”
        function init() {
            loadBasicEvaluation();
            updateProgress();
            bindEvents();
            setupStepEvents();
        }

        // ê¸°ë³¸ í‰ê°€ ë°ì´í„° ë¡œë“œ
        function loadBasicEvaluation() {
            const stored = localStorage.getItem('basicEvaluation');
            if (stored) {
                const data = JSON.parse(stored);
                evaluationData.restaurantName = data.restaurantName || evaluationData.restaurantName;
            }
        }

        // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
        function updateProgress() {
            const currentStep = evaluationData.currentStep;
            const progressPercent = ((currentStep - 1) / evaluationData.totalSteps) * 100;

            elements.progressFill.style.width = progressPercent + '%';
            elements.progressStep.textContent = `${currentStep}/${evaluationData.totalSteps}ë‹¨ê³„`;

            if (stepConfig[currentStep]) {
                elements.progressTitle.textContent = stepConfig[currentStep].title;
            }

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            elements.prevBtn.disabled = currentStep === 1;
            elements.nextBtn.disabled = !isCurrentStepValid();

            if (currentStep === evaluationData.totalSteps + 1) {
                elements.nextBtn.textContent = 'í™ˆìœ¼ë¡œ';
                elements.nextBtn.disabled = false;
            } else {
                elements.nextBtn.textContent = currentStep === evaluationData.totalSteps ? 'ì™„ë£Œ' : 'ë‹¤ìŒ';
            }
        }

        // í˜„ì¬ ë‹¨ê³„ ìœ íš¨ì„± í™•ì¸
        function isCurrentStepValid() {
            const currentStep = evaluationData.currentStep;

            if (currentStep <= evaluationData.totalSteps) {
                const factor = stepConfig[currentStep].factor;
                return evaluationData.scores[factor].score > 0;
            }

            return true;
        }

        // ë‹¨ê³„ë³„ ì´ë²¤íŠ¸ ì„¤ì •
        function setupStepEvents() {
            // ì ìˆ˜ ë²„íŠ¼ë“¤
            document.querySelectorAll('.score-buttons').forEach(container => {
                container.addEventListener('click', (e) => {
                    if (e.target.closest('.score-button')) {
                        const button = e.target.closest('.score-button');
                        const score = parseInt(button.dataset.score);
                        const factorId = container.id.replace('Score', '');

                        selectScore(factorId, score, container);
                    }
                });
            });

            // ê¸°ëŒ€ì¹˜ ë¹„êµ ë²„íŠ¼ë“¤
            document.querySelectorAll('.compare-options').forEach(container => {
                container.addEventListener('click', (e) => {
                    if (e.target.closest('.compare-option')) {
                        const button = e.target.closest('.compare-option');
                        const comparison = button.dataset.compare;
                        const factorId = container.id.replace('Expectation', '');

                        selectExpectation(factorId, comparison, container);
                    }
                });
            });

            // íƒœê·¸ ë²„íŠ¼ë“¤
            document.querySelectorAll('.quick-tags').forEach(container => {
                container.addEventListener('click', (e) => {
                    if (e.target.closest('.tag-button')) {
                        const button = e.target.closest('.tag-button');
                        const tag = button.dataset.tag;
                        const factorId = container.id.replace('Tags', '');

                        toggleTag(factorId, tag, button);
                    }
                });
            });

            // ì½”ë©˜íŠ¸ ì…ë ¥
            const tasteComment = document.getElementById('tasteComment');
            if (tasteComment) {
                tasteComment.addEventListener('input', (e) => {
                    evaluationData.scores.taste.comment = e.target.value;
                });
            }
        }

        // ì ìˆ˜ ì„ íƒ
        function selectScore(factor, score, container) {
            evaluationData.scores[factor].score = score;

            // UI ì—…ë°ì´íŠ¸
            container.querySelectorAll('.score-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            container.querySelector(`[data-score="${score}"]`).classList.add('selected');

            updateProgress();
        }

        // ê¸°ëŒ€ì¹˜ ë¹„êµ ì„ íƒ
        function selectExpectation(factor, comparison, container) {
            evaluationData.scores[factor].expectation = comparison;

            // UI ì—…ë°ì´íŠ¸
            container.querySelectorAll('.compare-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            container.querySelector(`[data-compare="${comparison}"]`).classList.add('selected');
        }

        // íƒœê·¸ í† ê¸€
        function toggleTag(factor, tag, button) {
            const tags = evaluationData.scores[factor].tags;
            const index = tags.indexOf(tag);

            if (index > -1) {
                tags.splice(index, 1);
                button.classList.remove('selected');
            } else {
                tags.push(tag);
                button.classList.add('selected');
            }
        }

        // ì´ë²¤íŠ¸ ë°”ì¸ë”©
        function bindEvents() {
            // ì´ì „/ë‹¤ìŒ ë²„íŠ¼
            elements.prevBtn.addEventListener('click', () => {
                if (evaluationData.currentStep > 1) {
                    changeStep(evaluationData.currentStep - 1);
                }
            });

            elements.nextBtn.addEventListener('click', () => {
                if (evaluationData.currentStep <= evaluationData.totalSteps) {
                    if (evaluationData.currentStep === evaluationData.totalSteps) {
                        calculatePersonalScore();
                        changeStep(evaluationData.currentStep + 1);
                    } else {
                        changeStep(evaluationData.currentStep + 1);
                    }
                } else {
                    // ì™„ë£Œ í›„ í™ˆìœ¼ë¡œ
                    saveEvaluationData();
                    window.location.href = '01-í™ˆí™”ë©´.html';
                }
            });

            // ë’¤ë¡œê°€ê¸°
            document.querySelector('.back-button').addEventListener('click', () => {
                if (confirm('í‰ê°€ë¥¼ ì¤‘ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì§€ê¸ˆê¹Œì§€ì˜ ë‚´ìš©ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')) {
                    window.history.back();
                }
            });
        }

        // ë‹¨ê³„ ë³€ê²½
        function changeStep(newStep) {
            // í˜„ì¬ ë‹¨ê³„ ìˆ¨ê¸°ê¸°
            document.querySelector('.evaluation-step.active').classList.remove('active');

            // ìƒˆë¡œìš´ ë‹¨ê³„ í‘œì‹œ
            document.getElementById(`step${newStep}`).classList.add('active');

            evaluationData.currentStep = newStep;
            updateProgress();
        }

        // ê°œì¸í™” ì ìˆ˜ ê³„ì‚°
        function calculatePersonalScore() {
            const scores = evaluationData.scores;
            let totalScore = 0;
            let weightedSum = 0;

            // ê°€ì¤‘ì¹˜ ì ìš© (ë§›ê³¼ ê°€ê²©ì„ ë” ì¤‘ìš”í•˜ê²Œ)
            const weights = { price: 0.3, portion: 0.2, taste: 0.35, service: 0.15 };

            Object.keys(weights).forEach(factor => {
                if (scores[factor].score > 0) {
                    weightedSum += scores[factor].score * weights[factor];
                    totalScore += weights[factor];
                }
            });

            // 0-100 ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜
            const personalScore = Math.round((weightedSum / totalScore) * 20);
            evaluationData.personalScore = personalScore;

            // ê°œì¸í™” ì¸ì‚¬ì´íŠ¸ ìƒì„±
            generatePersonalInsight();

            // UI ì—…ë°ì´íŠ¸
            updateResultsUI();
        }

        // ê°œì¸í™” ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function generatePersonalInsight() {
            const scores = evaluationData.scores;
            const insights = [];

            // ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ìš”ì†Œ ì°¾ê¸°
            const factorScores = {
                price: scores.price.score,
                taste: scores.taste.score,
                portion: scores.portion.score,
                service: scores.service.score
            };

            const topFactor = Object.keys(factorScores).reduce((a, b) =>
                factorScores[a] > factorScores[b] ? a : b
            );

            const factorNames = {
                price: 'ê°€ê²©',
                taste: 'ë§›',
                portion: 'ì–‘',
                service: 'ì„œë¹„ìŠ¤'
            };

            insights.push(`${factorNames[topFactor]}ì„ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ì‹œëŠ” í¸ì´ë„¤ìš”!`);

            // ê¸°ëŒ€ì¹˜ì™€ ì‹¤ì œ ë¹„êµ
            if (scores.price.expectation === 'lower') {
                insights.push('ê°€ê²©ì´ ì €ë ´í•œ ê³³ì„ ìš°ì„  ì¶”ì²œí•´ë“œë¦´ê²Œìš”.');
            } else if (scores.taste.score >= 4) {
                insights.push('ë§›ìˆëŠ” ìŒì‹ì ì„ ìš°ì„  ì¶”ì²œí•´ë“œë¦´ê²Œìš”.');
            }

            evaluationData.personalInsight = insights.join(' ');
        }

        // ê²°ê³¼ UI ì—…ë°ì´íŠ¸
        function updateResultsUI() {
            const scores = evaluationData.scores;

            elements.finalScore.textContent = evaluationData.personalScore;
            elements.personalInsight.textContent = evaluationData.personalInsight;

            elements.priceResult.textContent = scores.price.score.toFixed(1);
            elements.portionResult.textContent = scores.portion.score.toFixed(1);
            elements.tasteResult.textContent = scores.taste.score.toFixed(1);
            elements.serviceResult.textContent = scores.service.score.toFixed(1);
        }

        // í‰ê°€ ë°ì´í„° ì €ì¥
        function saveEvaluationData() {
            const completedEvaluation = {
                restaurantName: evaluationData.restaurantName,
                timestamp: Date.now(),
                scores: evaluationData.scores,
                personalScore: evaluationData.personalScore,
                personalInsight: evaluationData.personalInsight
            };

            // ê¸°ì¡´ í‰ê°€ ëª©ë¡ì— ì¶”ê°€
            const evaluationHistory = JSON.parse(localStorage.getItem('evaluationHistory') || '[]');
            evaluationHistory.unshift(completedEvaluation);

            // ìµœëŒ€ 50ê°œê¹Œì§€ë§Œ ì €ì¥
            if (evaluationHistory.length > 50) {
                evaluationHistory.splice(50);
            }

            localStorage.setItem('evaluationHistory', JSON.stringify(evaluationHistory));

            // ì„ì‹œ ë°ì´í„° ì •ë¦¬
            localStorage.removeItem('basicEvaluation');
            localStorage.removeItem('completedOrder');
            localStorage.removeItem('currentOrder');

            alert('í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆì–´ìš”! ë” ì •í™•í•œ ë§›ì§‘ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”. ğŸ‰');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', init);

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì„ì‹œ ì €ì¥
        window.addEventListener('beforeunload', () => {
            if (evaluationData.currentStep > 1) {
                localStorage.setItem('tempDetailedEvaluation', JSON.stringify(evaluationData));
            }
        });

        // ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì§€ì› (ëª¨ë°”ì¼)
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0 && evaluationData.currentStep < evaluationData.totalSteps) {
                    // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ = ë‹¤ìŒ
                    if (isCurrentStepValid()) {
                        elements.nextBtn.click();
                    }
                } else if (diff < 0 && evaluationData.currentStep > 1) {
                    // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ = ì´ì „
                    elements.prevBtn.click();
                }
            }
        }
    </script>
</body>
</html>