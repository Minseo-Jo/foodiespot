<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌôàÌôîÎ©¥ - ÎßõÏßë Ï∂îÏ≤ú ÏÑúÎπÑÏä§</title>
    <link rel="stylesheet" href="common.css">
    <style>
        body {
            padding-bottom: 80px; /* ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Í≥µÍ∞Ñ */
        }

        .location-bar {
            background: var(--white);
            padding: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .location-icon {
            color: var(--primary-blue);
            font-size: 18px;
        }

        .location-text {
            flex: 1;
            font-size: 14px;
            color: var(--gray-700);
        }

        .location-change {
            color: var(--primary-blue);
            font-size: 12px;
            text-decoration: none;
        }

        .search-section {
            padding: var(--space-6) var(--space-4);
            background: var(--white);
        }

        .search-container {
            position: relative;
            margin-bottom: var(--space-4);
        }

        .search-input {
            width: 100%;
            padding: var(--space-4) var(--space-12) var(--space-4) var(--space-4);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            font-size: 16px;
            background: var(--gray-50);
        }

        .search-input:focus {
            background: var(--white);
            border-color: var(--primary-blue);
        }

        .search-icon {
            position: absolute;
            right: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
            font-size: 20px;
        }

        .radius-selector {
            display: flex;
            gap: var(--space-2);
            justify-content: center;
        }

        .radius-option {
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-xl);
            background: var(--white);
            color: var(--gray-600);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radius-option.active {
            background: var(--primary-blue);
            color: var(--white);
            border-color: var(--primary-blue);
        }

        .recommendations-section {
            padding: 0 var(--space-4);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding: var(--space-4) 0;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .see-more {
            color: var(--primary-blue);
            font-size: 12px;
            text-decoration: none;
        }

        .restaurant-cards {
            display: flex;
            gap: var(--space-4);
            overflow-x: auto;
            padding-bottom: var(--space-2);
            scroll-snap-type: x mandatory;
        }

        .restaurant-card {
            flex: 0 0 280px;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            scroll-snap-align: start;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .restaurant-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .restaurant-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
            background: var(--gray-200);
        }

        .restaurant-info {
            padding: var(--space-4);
        }

        .restaurant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-2);
        }

        .restaurant-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
        }

        .restaurant-category {
            font-size: 12px;
            color: var(--gray-500);
        }

        .restaurant-metrics {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .distance {
            font-size: 12px;
            color: var(--gray-500);
        }

        .quick-actions {
            padding: var(--space-4);
            background: var(--white);
            margin-top: var(--space-6);
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-3);
        }

        .quick-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            text-decoration: none;
            color: var(--gray-700);
            transition: all 0.2s ease;
        }

        .quick-action:hover {
            background: var(--primary-blue-light);
            color: var(--primary-blue-dark);
        }

        .quick-action-icon {
            font-size: 24px;
            margin-bottom: var(--space-2);
        }

        .quick-action-label {
            font-size: 12px;
            font-weight: 500;
        }

        /* Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùº */
        .restaurant-cards::-webkit-scrollbar {
            height: 4px;
        }

        .restaurant-cards::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 2px;
        }

        .restaurant-cards::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 2px;
        }

        .restaurant-cards::-webkit-scrollbar-thumb:hover {
            background: var(--gray-400);
        }

        /* Îπà ÏÉÅÌÉú */
        .empty-state {
            text-align: center;
            padding: var(--space-8);
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 14px;
            line-height: 1.6;
        }

        /* Î°úÎî© ÏÉÅÌÉú */
        .loading-card {
            flex: 0 0 280px;
        }

        .loading-image {
            width: 100%;
            height: 140px;
        }

        .loading-text {
            height: 16px;
            margin-bottom: var(--space-2);
        }

        .loading-text.short {
            width: 60%;
        }
    </style>
</head>
<body>
    <!-- ÏÉÅÎã® ÏúÑÏπò Î∞î -->
    <div class="location-bar">
        <span class="location-icon">üìç</span>
        <span class="location-text" id="currentLocation">ÏúÑÏπòÎ•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë...</span>
        <a href="#" class="location-change" onclick="changeLocation()">Î≥ÄÍ≤Ω</a>
    </div>

    <!-- Í≤ÄÏÉâ ÏÑπÏÖò -->
    <div class="search-section">
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="ÏãùÎãπ, Î©îÎâ¥Î•º Í≤ÄÏÉâÌï¥Î≥¥ÏÑ∏Ïöî">
            <span class="search-icon">üîç</span>
        </div>

        <div class="radius-selector">
            <button class="radius-option" data-radius="300">300m</button>
            <button class="radius-option active" data-radius="500">500m</button>
            <button class="radius-option" data-radius="1000">1km</button>
            <button class="radius-option" data-radius="2000">2km</button>
        </div>
    </div>

    <!-- Í∞úÏù∏Ìôî Ï∂îÏ≤ú ÏÑπÏÖò -->
    <div class="recommendations-section">
        <div class="section-header">
            <h2 class="section-title">ÎÇ¥ Ï∑®Ìñ• ÎßûÏ∂§ Ï∂îÏ≤ú</h2>
            <a href="#" class="see-more">ÎçîÎ≥¥Í∏∞</a>
        </div>

        <div class="restaurant-cards" id="recommendationCards">
            <!-- Î°úÎî© Ïπ¥ÎìúÎì§ -->
            <div class="loading-card card skeleton">
                <div class="loading-image skeleton"></div>
                <div class="restaurant-info">
                    <div class="loading-text skeleton"></div>
                    <div class="loading-text skeleton short"></div>
                </div>
            </div>
            <div class="loading-card card skeleton">
                <div class="loading-image skeleton"></div>
                <div class="restaurant-info">
                    <div class="loading-text skeleton"></div>
                    <div class="loading-text skeleton short"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïù∏Í∏∞ ÎßõÏßë ÏÑπÏÖò -->
    <div class="recommendations-section">
        <div class="section-header">
            <h2 class="section-title">Ïù∏Í∑º Ïù∏Í∏∞ ÎßõÏßë</h2>
            <a href="#" class="see-more">ÎçîÎ≥¥Í∏∞</a>
        </div>

        <div class="restaurant-cards" id="popularCards">
            <!-- JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ± -->
        </div>
    </div>

    <!-- Îπ†Î•∏ Ïï°ÏÖò -->
    <div class="quick-actions">
        <h3 class="section-title mb-4">Îπ†Î•∏ Ïï°ÏÖò</h3>
        <div class="quick-actions-grid">
            <a href="#" class="quick-action" onclick="Utils.navigateTo('09-Í∞úÏù∏Î∂ÑÏÑù')">
                <div class="quick-action-icon">üìä</div>
                <div class="quick-action-label">ÎÇ¥ Î∂ÑÏÑù</div>
            </a>
            <a href="#" class="quick-action" onclick="Utils.navigateTo('06-Ï£ºÎ¨∏ÏÉÅÌÉú')">
                <div class="quick-action-icon">üçΩÔ∏è</div>
                <div class="quick-action-label">Ï£ºÎ¨∏ ÏÉÅÌÉú</div>
            </a>
        </div>
    </div>

    <!-- ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <div class="bottom-nav">
        <div class="bottom-nav-content">
            <a href="#" class="bottom-nav-item active">
                <div class="bottom-nav-icon">üè†</div>
                <div class="bottom-nav-label">Ìôà</div>
            </a>
            <a href="#" class="bottom-nav-item" onclick="performSearch()">
                <div class="bottom-nav-icon">üîç</div>
                <div class="bottom-nav-label">Í≤ÄÏÉâ</div>
            </a>
            <a href="#" class="bottom-nav-item" onclick="Utils.navigateTo('06-Ï£ºÎ¨∏ÏÉÅÌÉú')">
                <div class="bottom-nav-icon">üçΩÔ∏è</div>
                <div class="bottom-nav-label">Ï£ºÎ¨∏</div>
            </a>
            <a href="#" class="bottom-nav-item" onclick="Utils.navigateTo('09-Í∞úÏù∏Î∂ÑÏÑù')">
                <div class="bottom-nav-icon">üë§</div>
                <div class="bottom-nav-label">ÎÇ¥ Ï†ïÎ≥¥</div>
            </a>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', async () => {
            await initializePage();
        });

        // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        async function initializePage() {
            try {
                // ÏúÑÏπò Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
                await getCurrentLocation();

                // Ï∂îÏ≤ú ÏãùÎãπ Î°úÎìú
                await loadRecommendations();

                // Ïù∏Í∏∞ ÏãùÎãπ Î°úÎìú
                await loadPopularRestaurants();

            } catch (error) {
                console.error('ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
                Utils.showToast('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // ÌòÑÏû¨ ÏúÑÏπò Í∞ÄÏ†∏Ïò§Í∏∞
        async function getCurrentLocation() {
            const locationElement = document.getElementById('currentLocation');

            try {
                const location = await LocationService.getCurrentLocation();
                // Ïã§Ï†úÎ°úÎäî Ïó≠ÏßÄÏò§ÏΩîÎî© API ÏÇ¨Ïö©
                locationElement.textContent = 'Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú (ÌòÑÏû¨ ÏúÑÏπò)';
            } catch (error) {
                locationElement.textContent = 'ÏúÑÏπò Ï†ïÎ≥¥ ÏóÜÏùå (ÏàòÎèô ÏÑ§Ï†ï Í∞ÄÎä•)';
                Utils.showToast(error.message, 'warning');
            }
        }

        // Ï∂îÏ≤ú ÏãùÎãπ Î°úÎìú
        async function loadRecommendations() {
            const container = document.getElementById('recommendationCards');

            try {
                const restaurants = await DataService.searchRestaurants('', AppState.currentLocation, AppState.searchRadius);

                if (restaurants.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üçΩÔ∏è</div>
                            <div class="empty-state-text">Ï∂îÏ≤úÌï† ÎßõÏßëÏù¥ ÏóÜÏäµÎãàÎã§.<br>Í≤ÄÏÉâ Î∞òÍ≤ΩÏùÑ ÎÑìÌòÄÎ≥¥ÏÑ∏Ïöî.</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = restaurants.map(restaurant => createRestaurantCard(restaurant)).join('');

                // Ïπ¥Îìú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                container.querySelectorAll('.restaurant-card').forEach((card, index) => {
                    card.addEventListener('click', () => {
                        AppState.selectedRestaurant = restaurants[index];
                        Utils.session.set('selectedRestaurant', restaurants[index]);
                        Utils.navigateTo('03-ÏãùÎãπÏÉÅÏÑ∏');
                    });
                });

            } catch (error) {
                console.error('Ï∂îÏ≤ú ÏãùÎãπ Î°úÎìú Ïò§Î•ò:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ùå</div>
                        <div class="empty-state-text">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</div>
                    </div>
                `;
            }
        }

        // Ïù∏Í∏∞ ÏãùÎãπ Î°úÎìú (Îã§Î•∏ Ï†ïÎ†¨)
        async function loadPopularRestaurants() {
            const container = document.getElementById('popularCards');

            try {
                const restaurants = await DataService.searchRestaurants('', AppState.currentLocation, AppState.searchRadius);
                const popularRestaurants = restaurants.sort((a, b) => b.rating - a.rating);

                container.innerHTML = popularRestaurants.map(restaurant => createRestaurantCard(restaurant)).join('');

                // Ïπ¥Îìú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                container.querySelectorAll('.restaurant-card').forEach((card, index) => {
                    card.addEventListener('click', () => {
                        AppState.selectedRestaurant = popularRestaurants[index];
                        Utils.session.set('selectedRestaurant', popularRestaurants[index]);
                        Utils.navigateTo('03-ÏãùÎãπÏÉÅÏÑ∏');
                    });
                });

            } catch (error) {
                console.error('Ïù∏Í∏∞ ÏãùÎãπ Î°úÎìú Ïò§Î•ò:', error);
            }
        }

        // ÏãùÎãπ Ïπ¥Îìú ÏÉùÏÑ±
        function createRestaurantCard(restaurant) {
            const waitTimeClass = Utils.getWaitTimeClass(restaurant.waitTime);
            const valueScoreClass = Utils.getValueScoreClass(restaurant.valueScore);

            return `
                <div class="restaurant-card touchable" data-restaurant-id="${restaurant.id}">
                    <img src="${restaurant.image}" alt="${restaurant.name}" class="restaurant-image">
                    <div class="restaurant-info">
                        <div class="restaurant-header">
                            <div>
                                <div class="restaurant-name">${restaurant.name}</div>
                                <div class="restaurant-category">${restaurant.category}</div>
                            </div>
                            <div class="value-score ${valueScoreClass}">${restaurant.valueScore.toFixed(1)}</div>
                        </div>

                        <div class="restaurant-metrics">
                            <div class="metric-row">
                                <div class="rating">
                                    <span class="rating-star filled">‚òÖ</span>
                                    <span class="rating-score">${restaurant.rating.toFixed(1)}</span>
                                    <span class="rating-count">(${restaurant.reviewCount})</span>
                                </div>
                                <div class="wait-time ${waitTimeClass}">
                                    ${restaurant.waitTime === 0 ? 'ÎåÄÍ∏∞ÏóÜÏùå' : restaurant.waitTime + 'Î∂Ñ ÎåÄÍ∏∞'}
                                </div>
                            </div>

                            <div class="metric-row">
                                <div class="distance">${Utils.formatDistance(restaurant.distance)}</div>
                                <div class="price-range">
                                    <span class="price-symbol ${restaurant.priceRange}"></span>
                                    ÌèâÍ∑† ${Utils.formatPrice(restaurant.averagePrice)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Í≤ÄÏÉâ ÏàòÌñâ
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();

            if (query) {
                Utils.session.set('searchQuery', query);
                Utils.session.set('searchRadius', AppState.searchRadius);
                Utils.navigateTo('02-Í≤ÄÏÉâÍ≤∞Í≥º');
            } else {
                Utils.navigateTo('02-Í≤ÄÏÉâÍ≤∞Í≥º');
            }
        }

        // ÏúÑÏπò Î≥ÄÍ≤Ω
        function changeLocation() {
            Utils.showToast('ÏúÑÏπò Î≥ÄÍ≤Ω Í∏∞Îä•ÏùÄ Ï∂îÌõÑ Íµ¨ÌòÑ ÏòàÏ†ïÏûÖÎãàÎã§.', 'info');
        }

        // Í≤ÄÏÉâÏ∞Ω ÏóîÌÑ∞ ÌÇ§ Ï≤òÎ¶¨
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Î∞òÍ≤Ω ÏÑ†ÌÉù Ï≤òÎ¶¨
        document.querySelectorAll('.radius-option').forEach(option => {
            option.addEventListener('click', () => {
                // ÌôúÏÑ± ÏÉÅÌÉú Î≥ÄÍ≤Ω
                document.querySelectorAll('.radius-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');

                // Ïï± ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                AppState.searchRadius = parseInt(option.dataset.radius);

                // Ï∂îÏ≤ú ÏãùÎãπ Îã§Ïãú Î°úÎìú
                loadRecommendations();
                loadPopularRestaurants();
            });
        });

        // Í≤ÄÏÉâÏ∞Ω Ìè¨Ïª§Ïä§/Î∏îÎü¨ Ìö®Í≥º
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('focus', () => {
            searchInput.parentElement.style.transform = 'scale(1.02)';
        });

        searchInput.addEventListener('blur', () => {
            searchInput.parentElement.style.transform = 'scale(1)';
        });

        // Ïä§ÌÅ¨Î°§ Ïãú ÏúÑÏπò Î∞î Ïà®ÍπÄ/ÌëúÏãú
        let lastScrollTop = 0;
        window.addEventListener('scroll', () => {
            const locationBar = document.querySelector('.location-bar');
            const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (currentScrollTop > lastScrollTop && currentScrollTop > 50) {
                // ÏïÑÎûòÎ°ú Ïä§ÌÅ¨Î°§
                locationBar.style.transform = 'translateY(-100%)';
            } else {
                // ÏúÑÎ°ú Ïä§ÌÅ¨Î°§
                locationBar.style.transform = 'translateY(0)';
            }

            lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop;
        });
    </script>
</body>
</html>