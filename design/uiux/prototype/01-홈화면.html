<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™ˆí™”ë©´ - ë§›ì§‘ ì¶”ì²œ ì„œë¹„ìŠ¤</title>
    <link rel="stylesheet" href="common.css">
    <style>
        body {
            padding-bottom: 80px; /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ê³µê°„ */
        }

        .location-bar {
            background: var(--white);
            padding: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .location-icon {
            color: var(--primary-blue);
            font-size: 18px;
        }

        .location-text {
            flex: 1;
            font-size: 14px;
            color: var(--gray-700);
        }

        .location-change {
            color: var(--primary-blue);
            font-size: 12px;
            text-decoration: none;
        }

        .search-section {
            padding: var(--space-6) var(--space-4);
            background: var(--white);
        }

        .search-container {
            position: relative;
            margin-bottom: var(--space-4);
        }

        .search-input {
            width: 100%;
            padding: var(--space-4) var(--space-12) var(--space-4) var(--space-4);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            font-size: 16px;
            background: var(--gray-50);
        }

        .search-input:focus {
            background: var(--white);
            border-color: var(--primary-blue);
        }

        .search-icon {
            position: absolute;
            right: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
            font-size: 20px;
        }

        .radius-selector {
            display: flex;
            gap: var(--space-2);
            justify-content: center;
        }

        .radius-option {
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-xl);
            background: var(--white);
            color: var(--gray-600);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radius-option.active {
            background: var(--primary-blue);
            color: var(--white);
            border-color: var(--primary-blue);
        }

        .recommendations-section {
            padding: 0 var(--space-4);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding: var(--space-4) 0;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .see-more {
            color: var(--primary-blue);
            font-size: 12px;
            text-decoration: none;
        }

        .restaurant-cards {
            display: flex;
            gap: var(--space-4);
            overflow-x: auto;
            padding-bottom: var(--space-2);
            scroll-snap-type: x mandatory;
        }

        .restaurant-card {
            flex: 0 0 280px;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            scroll-snap-align: start;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .restaurant-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .restaurant-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
            background: var(--gray-200);
        }

        .restaurant-info {
            padding: var(--space-4);
        }

        .restaurant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-2);
        }

        .restaurant-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
        }

        .restaurant-category {
            font-size: 12px;
            color: var(--gray-500);
        }

        .restaurant-metrics {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .distance {
            font-size: 12px;
            color: var(--gray-500);
        }

        .quick-actions {
            padding: var(--space-4);
            background: var(--white);
            margin-top: var(--space-6);
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-3);
        }

        .quick-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            text-decoration: none;
            color: var(--gray-700);
            transition: all 0.2s ease;
        }

        .quick-action:hover {
            background: var(--primary-blue-light);
            color: var(--primary-blue-dark);
        }

        .quick-action-icon {
            font-size: 24px;
            margin-bottom: var(--space-2);
        }

        .quick-action-label {
            font-size: 12px;
            font-weight: 500;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .restaurant-cards::-webkit-scrollbar {
            height: 4px;
        }

        .restaurant-cards::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 2px;
        }

        .restaurant-cards::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 2px;
        }

        .restaurant-cards::-webkit-scrollbar-thumb:hover {
            background: var(--gray-400);
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: var(--space-8);
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 14px;
            line-height: 1.6;
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading-card {
            flex: 0 0 280px;
        }

        .loading-image {
            width: 100%;
            height: 140px;
        }

        .loading-text {
            height: 16px;
            margin-bottom: var(--space-2);
        }

        .loading-text.short {
            width: 60%;
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ ìœ„ì¹˜ ë°” -->
    <div class="location-bar">
        <span class="location-icon">ğŸ“</span>
        <span class="location-text" id="currentLocation">ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</span>
        <a href="#" class="location-change" onclick="changeLocation()">ë³€ê²½</a>
    </div>

    <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
    <div class="search-section">
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="ì‹ë‹¹, ë©”ë‰´ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”">
            <span class="search-icon">ğŸ”</span>
        </div>

        <div class="radius-selector">
            <button class="radius-option" data-radius="300">300m</button>
            <button class="radius-option active" data-radius="500">500m</button>
            <button class="radius-option" data-radius="1000">1km</button>
            <button class="radius-option" data-radius="2000">2km</button>
        </div>
    </div>

    <!-- ê°œì¸í™” ì¶”ì²œ ì„¹ì…˜ -->
    <div class="recommendations-section">
        <div class="section-header">
            <h2 class="section-title">ë‚´ ì·¨í–¥ ë§ì¶¤ ì¶”ì²œ</h2>
            <a href="#" class="see-more">ë”ë³´ê¸°</a>
        </div>

        <div class="restaurant-cards" id="recommendationCards">
            <!-- ë¡œë”© ì¹´ë“œë“¤ -->
            <div class="loading-card card skeleton">
                <div class="loading-image skeleton"></div>
                <div class="restaurant-info">
                    <div class="loading-text skeleton"></div>
                    <div class="loading-text skeleton short"></div>
                </div>
            </div>
            <div class="loading-card card skeleton">
                <div class="loading-image skeleton"></div>
                <div class="restaurant-info">
                    <div class="loading-text skeleton"></div>
                    <div class="loading-text skeleton short"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¸ê¸° ë§›ì§‘ ì„¹ì…˜ -->
    <div class="recommendations-section">
        <div class="section-header">
            <h2 class="section-title">ì¸ê·¼ ì¸ê¸° ë§›ì§‘</h2>
            <a href="#" class="see-more">ë”ë³´ê¸°</a>
        </div>

        <div class="restaurant-cards" id="popularCards">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
    </div>

    <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
    <div class="quick-actions">
        <h3 class="section-title mb-4">ë¹ ë¥¸ ì•¡ì…˜</h3>
        <div class="quick-actions-grid">
            <a href="#" class="quick-action" onclick="Utils.navigateTo('09-ê°œì¸ë¶„ì„')">
                <div class="quick-action-icon">ğŸ“Š</div>
                <div class="quick-action-label">ë‚´ ë¶„ì„</div>
            </a>
            <a href="#" class="quick-action" onclick="Utils.navigateTo('06-ì£¼ë¬¸ìƒíƒœ')">
                <div class="quick-action-icon">ğŸ½ï¸</div>
                <div class="quick-action-label">ì£¼ë¬¸ ìƒíƒœ</div>
            </a>
        </div>
    </div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="bottom-nav">
        <div class="bottom-nav-content">
            <a href="#" class="bottom-nav-item active">
                <div class="bottom-nav-icon">ğŸ </div>
                <div class="bottom-nav-label">í™ˆ</div>
            </a>
            <a href="#" class="bottom-nav-item" onclick="performSearch()">
                <div class="bottom-nav-icon">ğŸ”</div>
                <div class="bottom-nav-label">ê²€ìƒ‰</div>
            </a>
            <a href="#" class="bottom-nav-item" onclick="Utils.navigateTo('06-ì£¼ë¬¸ìƒíƒœ')">
                <div class="bottom-nav-icon">ğŸ½ï¸</div>
                <div class="bottom-nav-label">ì£¼ë¬¸</div>
            </a>
            <a href="#" class="bottom-nav-item" onclick="Utils.navigateTo('09-ê°œì¸ë¶„ì„')">
                <div class="bottom-nav-icon">ğŸ‘¤</div>
                <div class="bottom-nav-label">ë‚´ ì •ë³´</div>
            </a>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            await initializePage();
        });

        // í˜ì´ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
        async function initializePage() {
            try {
                // ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                await getCurrentLocation();

                // ì¶”ì²œ ì‹ë‹¹ ë¡œë“œ
                await loadRecommendations();

                // ì¸ê¸° ì‹ë‹¹ ë¡œë“œ
                await loadPopularRestaurants();

            } catch (error) {
                console.error('í˜ì´ì§€ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                Utils.showToast('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        async function getCurrentLocation() {
            const locationElement = document.getElementById('currentLocation');

            try {
                const location = await LocationService.getCurrentLocation();
                // ì‹¤ì œë¡œëŠ” ì—­ì§€ì˜¤ì½”ë”© API ì‚¬ìš©
                locationElement.textContent = 'ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ (í˜„ì¬ ìœ„ì¹˜)';
            } catch (error) {
                locationElement.textContent = 'ìœ„ì¹˜ ì •ë³´ ì—†ìŒ (ìˆ˜ë™ ì„¤ì • ê°€ëŠ¥)';
                Utils.showToast(error.message, 'warning');
            }
        }

        // ì¶”ì²œ ì‹ë‹¹ ë¡œë“œ
        async function loadRecommendations() {
            const container = document.getElementById('recommendationCards');

            try {
                const restaurants = await DataService.searchRestaurants('', AppState.currentLocation, AppState.searchRadius);

                if (restaurants.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ½ï¸</div>
                            <div class="empty-state-text">ì¶”ì²œí•  ë§›ì§‘ì´ ì—†ìŠµë‹ˆë‹¤.<br>ê²€ìƒ‰ ë°˜ê²½ì„ ë„“í˜€ë³´ì„¸ìš”.</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = restaurants.map(restaurant => createRestaurantCard(restaurant)).join('');

                // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                container.querySelectorAll('.restaurant-card').forEach((card, index) => {
                    card.addEventListener('click', () => {
                        AppState.selectedRestaurant = restaurants[index];
                        Utils.session.set('selectedRestaurant', restaurants[index]);
                        Utils.navigateTo('03-ì‹ë‹¹ìƒì„¸');
                    });
                });

            } catch (error) {
                console.error('ì¶”ì²œ ì‹ë‹¹ ë¡œë“œ ì˜¤ë¥˜:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">âŒ</div>
                        <div class="empty-state-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
                    </div>
                `;
            }
        }

        // ì¸ê¸° ì‹ë‹¹ ë¡œë“œ (ë‹¤ë¥¸ ì •ë ¬)
        async function loadPopularRestaurants() {
            const container = document.getElementById('popularCards');

            try {
                const restaurants = await DataService.searchRestaurants('', AppState.currentLocation, AppState.searchRadius);
                const popularRestaurants = restaurants.sort((a, b) => b.rating - a.rating);

                container.innerHTML = popularRestaurants.map(restaurant => createRestaurantCard(restaurant)).join('');

                // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                container.querySelectorAll('.restaurant-card').forEach((card, index) => {
                    card.addEventListener('click', () => {
                        AppState.selectedRestaurant = popularRestaurants[index];
                        Utils.session.set('selectedRestaurant', popularRestaurants[index]);
                        Utils.navigateTo('03-ì‹ë‹¹ìƒì„¸');
                    });
                });

            } catch (error) {
                console.error('ì¸ê¸° ì‹ë‹¹ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì‹ë‹¹ ì¹´ë“œ ìƒì„±
        function createRestaurantCard(restaurant) {
            const waitTimeClass = Utils.getWaitTimeClass(restaurant.waitTime);
            const valueScoreClass = Utils.getValueScoreClass(restaurant.valueScore);

            return `
                <div class="restaurant-card touchable" data-restaurant-id="${restaurant.id}">
                    <img src="${restaurant.image}" alt="${restaurant.name}" class="restaurant-image">
                    <div class="restaurant-info">
                        <div class="restaurant-header">
                            <div>
                                <div class="restaurant-name">${restaurant.name}</div>
                                <div class="restaurant-category">${restaurant.category}</div>
                            </div>
                            <div class="value-score ${valueScoreClass}">${restaurant.valueScore.toFixed(1)}</div>
                        </div>

                        <div class="restaurant-metrics">
                            <div class="metric-row">
                                <div class="rating">
                                    <span class="rating-star filled">â˜…</span>
                                    <span class="rating-score">${restaurant.rating.toFixed(1)}</span>
                                    <span class="rating-count">(${restaurant.reviewCount})</span>
                                </div>
                                <div class="wait-time ${waitTimeClass}">
                                    ${restaurant.waitTime === 0 ? 'ëŒ€ê¸°ì—†ìŒ' : restaurant.waitTime + 'ë¶„ ëŒ€ê¸°'}
                                </div>
                            </div>

                            <div class="metric-row">
                                <div class="distance">${Utils.formatDistance(restaurant.distance)}</div>
                                <div class="price-range">
                                    <span class="price-symbol ${restaurant.priceRange}"></span>
                                    í‰ê·  ${Utils.formatPrice(restaurant.averagePrice)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ê²€ìƒ‰ ìˆ˜í–‰
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();

            if (query) {
                Utils.session.set('searchQuery', query);
                Utils.session.set('searchRadius', AppState.searchRadius);
                Utils.navigateTo('02-ê²€ìƒ‰ê²°ê³¼');
            } else {
                Utils.navigateTo('02-ê²€ìƒ‰ê²°ê³¼');
            }
        }

        // ìœ„ì¹˜ ë³€ê²½
        function changeLocation() {
            Utils.showToast('ìœ„ì¹˜ ë³€ê²½ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.', 'info');
        }

        // ê²€ìƒ‰ì°½ ì—”í„° í‚¤ ì²˜ë¦¬
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // ë°˜ê²½ ì„ íƒ ì²˜ë¦¬
        document.querySelectorAll('.radius-option').forEach(option => {
            option.addEventListener('click', () => {
                // í™œì„± ìƒíƒœ ë³€ê²½
                document.querySelectorAll('.radius-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');

                // ì•± ìƒíƒœ ì—…ë°ì´íŠ¸
                AppState.searchRadius = parseInt(option.dataset.radius);

                // ì¶”ì²œ ì‹ë‹¹ ë‹¤ì‹œ ë¡œë“œ
                loadRecommendations();
                loadPopularRestaurants();
            });
        });

        // ê²€ìƒ‰ì°½ í¬ì»¤ìŠ¤/ë¸”ëŸ¬ íš¨ê³¼
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('focus', () => {
            searchInput.parentElement.style.transform = 'scale(1.02)';
        });

        searchInput.addEventListener('blur', () => {
            searchInput.parentElement.style.transform = 'scale(1)';
        });

        // ìŠ¤í¬ë¡¤ ì‹œ ìœ„ì¹˜ ë°” ìˆ¨ê¹€/í‘œì‹œ
        let lastScrollTop = 0;
        window.addEventListener('scroll', () => {
            const locationBar = document.querySelector('.location-bar');
            const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (currentScrollTop > lastScrollTop && currentScrollTop > 50) {
                // ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
                locationBar.style.transform = 'translateY(-100%)';
            } else {
                // ìœ„ë¡œ ìŠ¤í¬ë¡¤
                locationBar.style.transform = 'translateY(0)';
            }

            lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop;
        });
    </script>
</body>
</html>